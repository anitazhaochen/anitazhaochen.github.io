---
title: MySQL索引
tags:
---



## 数据库中 DQL、DML、DDL、DCL 的概念及区别

### DDL

数据库定义语言

使用DDL来创建数据库中的各种对象如：

表、视图、索引、同义词、聚簇等

CREATE TABLE/VIEW/INDEX/SYN/CLUSTER



### DML

数据库操作DML的三种形式：

插入： INSERT

更新： UPDATE

删除： DELETE

### DQL

数据库查询语言DQL基本结构是由 SELECT 子句，FROM 子句，WHERE子句组成的查询块：

SELECT <字段名表>

FROM <表或视图名>

WHERE <查询条件>

### DCL

数据控制语言 DCL 用来授予或者回收数据库的某种权限，并能控制数据库操作事务发生的结果及效果，对数据库实行监控等。

如：

GRANT： 授权

ROLLBACK  [WORK] TO [SAVEPOINT]：回退到某一点

回滚： ROLLBACK

回滚命令使数据库状态回到上一次提交的状态：格式为：

SQL> ROLLBACK





B+ Tree 索引： 顺序存储，每一个叶子节点到根节点的距离是相同的



根据点--> 二级节点 -- > 三级节点 --> 数据

在每一个层级 完成 一次 IO 就可以查到



可以使用 B-Tree 索引的查询类型： 全键值、键值范围或键前缀查找

​	全值匹配： 精确某个值

​	匹配最左前缀：只精确匹配起头部分， ‘Jin%’

​	匹配范围值：

​		精确匹配某一列并范围匹配另一列

​	不适合 B-Tree 索引的场景：

​		如果不从最左列开始，索引无效：（Age，Name）

​		不能跳过索引中的列： （StuID， Name， Age）

​		如果查询中某个列是范围查询，那么其右侧的列都无法再使用索引优化查询(StuID, Name)



Hash 索引： 基于哈希表，特别适用于精确匹配索引中的所有列

​	注意： 只有 Memory 存储引擎支持显示 hash 索引

​	适用场景：

​		只支持等值比较查询，包括 'IN' , '='

​	不适合使用 hash 索引的场景：

​		存储的非为值的顺序，因此，不适用于顺序查询

​		不支持模糊匹配 

空间索引（R-Tree）：

​	MyISAM支持空间索引：

全文索引（FULLTEXT）：

​	在文本中查询关键词



索引优点：

​	索引可以降低服务需要扫描的数据量，减少 IO 次数

​	索引可以帮助服务器避免排序和使用临时表

​	索引可以帮助将随机 IO 转换为顺序 IO

高性能索引策略：

​	独立使用列，尽量避免其参与运算

​	左前缀索引：索引构建于字段的左侧的多少个字符，要通过索引选择性来评估

​		索引选择性：不重复的索引值和数据表的记录总数的比值。

​	多列索引（组合索引）

​		AND 操作时更适合使用多列索引

​	选择合适的索引列次序：将选择性最高放左侧

覆盖索引：

​	查询完之后可以直接返回，减少一次 IO 。

冗余和重复索引：

​	不好的索引使用策略

​		比如 （NAME），（NAME，AGE）

​	第一种就是必须要的，如果查询 NAME，第二个索引是基于最左前缀的也用的上



通过 EXPLAIN 来分析索引的有效性：

​	EXPLAIN SELECT clause

​	获取查询执行计划信息，用来查询优化器如何执行查询



​	输出：

​		id: 当前查询语句中，每个 SELECT 语句的编号

​		复杂类型的查询有三种：

​			简单子查询： WHERE

​			用于 FROM 中的子查询

​			联合查询： UNION

​		注意： UNION 查询的分析结果会出现一个额外的匿名临时表

​	select_type：查询类型

​		简单查询为 SIMPLE 

​		复杂查询：

​			SUBQUERY： 简单子查询

​			DERIVED：用于 FROM 中的子查询

​			UNION： UNION 语句第一个之后的 SELECT 语句

​			UNION RESULT： 匿名临时表

​	type：关联类型，或访问类型，即 MySQL 决定如何去查询表中行的方式：

​		ALL：全表扫描：

​		index：根据索引的次序进行全表扫描，如果在 Extra列出现 ”Using index“ 表示使用了覆盖索引，而非全表扫描

​		range：有范围限制的根据索引实现范围扫描：扫描位置始于索引中的某一点，结束于另一点

​		ref：根据索引返回表中匹配某单个值的所有行

​		eq_ref：仅返回一个行，但需要与某个参考值做比较

​		const、system：直接返回单个行

​		NULL：

​	possible_keys:查询可能会用到的索引

​	key： 查询中使用了的索引

​	key_len: 在索引中使用的字节数



## MySQL 事务

事务：一组原子性的SQL查询，或者说是一个独立的单元

事务日志

### ACID

A: atomicity，原子性：整个事务中的所有操作要么全部成功哦，要么失败后回滚。

C：consistency，一致性：数据库总是从一个一致性状态转换为另一个一致性状态。

I：Isolation，隔离性：一个事务所做出的操作在提交之前，是不能为其它事务所见，隔离有多重隔离级别

D：durability：持久性，一旦事务提交，其所做的修改会永久保存于数据库中。



在MySQL 中使用事务：

启动事务： START TRANSACTION

结束事务：

（1） COMMIT：提交

（2）ROLLBACK：回滚

注意：只有事务型存储引擎才支持事务



### 锁

死锁：

两个或者多个事务在统一资源相互占用，并请求锁定对方占用的资源的状态

隐式锁：存储引擎自动加锁

显示锁：用户手动加锁

建议使用隐式锁



### MVCC

多版本并发控制



### 事务执行完后

事务执行完后，需要立即写入磁盘，但是有可能发生多次随机 IO，在磁盘上的位置可能并不连续，所以会先写入 事务日志中，因为事务日志是顺序 IO，然后再后台写入IO中

事务日志：

​	事务日志的写入类型为“追加”，因此其操作为“顺序IO”，此日志通常也被称为“预写式日志（write ahead  logging）”

