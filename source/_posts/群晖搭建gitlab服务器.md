---
title: 群晖搭建gitlab服务器
tags: [群晖,gitlab,docker]
category: 黑群晖
date: 2020-04-11 20:34:48
---

作为一个程序员，在公司基本上都是使用gitlab来对项目代码管理，但是作为一个初级的搬砖工，也就只有简单的push、pull和创建分支，修改wiki 的权限。工作之中考虑到许多代码都是可以复用的，需要用到的时候，又找很久，后面索性不找了，直接重写一遍。

在一个比较大的项目中，添加某些重复的功能，如果不能把它记下来，就只能一点点看源码，然后再添加，这感觉实在太痛苦。 既然 gitlab 可以管理代码，那写一个自己的工作总结及代码整理，开发流程岂不是挺好。

## 蜗牛星际矿渣主机

首先黑群晖配置是j3455 B款 双网口，8G内存，就是想装 gitlab 和 docker 和虚拟机所以把内存升级到了8G， 拆开机箱，看里面最多也只能插入一条内存条。

* 黑群晖，拿到蜗牛星际立马安装了黑群晖，考虑到都是工作之中的积累及代码记录，所以还是稳点比较好，准备买四块硬盘，两块做raid 0 两块一个做下载盘，一个做影音盘。

* 黑群晖中 vmm 虚拟机，做软路由。 已经关注了华硕 ac 86u 很久，但是价格一直坚挺，并且家里已经有一个废物的小米路由ac2100，无法刷机，所以再买一个路由还真有点舍不得。以前是在小米路由后面再加一个 斐讯K2， 然后 斐讯 K2 专门给投影仪这样不方便安装科学客户端的设备使用，小米路由是千兆，K2 是百兆，而我家宽带又是200兆的，所以加上光猫，光路由设备就有三台了，考虑到功耗，感觉有必要重新配置一下，就入手了星际蜗牛，使用 vmm 搭建了软路由。

    具体连接方式：光猫桥接然后光猫连接蜗牛星际其中一个网口，然后蜗牛星际另一个网口连接小米路由器的 wan 端口。这样小米路由器只充当了一个发射无线AP的WIFI的设备。拨号是放在软路由里面做的，科学及一些有用的插件都放到软路由里面。关于软路由lede群晖vmm安装网上已经有很多教程了。
<!--more -->
<!--more -->

    [群晖VMM安装软路由LEDE教程](https://post.smzdm.com/p/apze08d7/)

* 黑群晖中 GitLab 服务。

    安装方式很简单，直接在套件中心找到 gitlab 安装即可。这里说一下安装的时候遇到的一些问题。

    1. 安装失败

        安装这个软件我等了很久，然后告诉我安装失败了，具体哪里失败了也不知道，遇到这样的问题，就把原来的卸载，重启然后再重新安装。gitlab 是跑在 Docker 里面的，如果还是失败，可以先手动安装docker，并且点开docker 它自己会完成一些初始化的设置工作。然后再安装 gitlab 试试。

    2. Gitlab 访问 502 或者 500

        502：对用户访问请求的响应超时造成的

        500： 服务器错误

        502 和 500 我都遇到过，有可能启动gitlab后，服务还没有真正的运行起来，所以报了服务端错误，遇到这个问题，建议先等一会，再去访问 Gitlab，如果问题依旧，重启试试，如果还是不行，可能是内存太小，或者自己登陆ssh 查看下docker 的日志。

    3. STMP 设置

        在公司的 Gitlab 一般把你加入的一个项目及创建一个 merge 等等都会发送邮件通知。这里想让我们自己的Gitlab也有这种功能，比如可以和小伙伴一起开发项目，需要配置 STMP 服务。我用的是 QQ 邮箱的 STMP 服务。这里说一下 群晖里面 Gitlab 的配置文件在哪里，其实放在了 Docker 的环境变量中，直接修改环境变量即可。打开Docker---容器----编辑----环境变量----修改或添加相应值。可参考

        [群晖Gitlab修改STMP服务](https://blog.csdn.net/yinxiulong/article/details/88032833)

    4. 如果Gitlab直接放在公网又提供注册功能，很不安全，我们可以关闭注册功能。如果需要添加用户直接登录管理员账户就可以添加。具体操作：[Gitlab关闭注册功能](https://blog.csdn.net/ouyang_peng/article/details/78562125)

    5. 如果有需要https服务可参考：[群晖配置Gitlab https服务](https://blog.csdn.net/yinxiulong/article/details/79703990)





























